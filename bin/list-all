#!/usr/bin/env bash

if [ "$GITHUB_API_USER" = "" ] || [ "$GITHUB_API_KEY" = "" ]; then
  auth=""
else
  auth="-u $GITHUB_API_USER:$GITHUB_API_KEY"
fi

versions=$(curl $auth -s https://api.github.com/repos/php/php-src/git/refs/tags | # Fetch all tags
          grep '"ref":' | # Filter by refs
          grep 'php-' | # Filter only those related to php-xxxx
          sed 's/\"ref\"://' | # Remove '"ref":'
          sed 's/\"refs\/tags\/php-//' | # Remove '"refs/tags/php-"'
          sed 's/\",//') # Remove last '",'

# As per the documentation, all versions should be in a single line separated
# by spaces. We use `xargs` for this.
echo $versions | xargs
